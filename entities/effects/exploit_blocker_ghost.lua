local math = math
local util = util
local render = render

local scale = 1 / 11.7

function EFFECT:Init(data)
	self.EfOwner = data:GetEntity()	
	self:SetModel( "models/hunter/blocks/cube025x025x025.mdl" )
	self:SetMaterial("models/debug/debugwhite")
end

function EFFECT:Think()
	
	if !ValidEntity(self.EfOwner) then return false end
	if !ValidEntity(self.EfOwner:GetActiveWeapon()) then return false end
	if self.EfOwner:GetActiveWeapon():GetClass() ~= "admin_exploitblocker" then return false end
	if not self.EfOwner:Alive() then return false end
	
	local wep = self.EfOwner:GetActiveWeapon()
	self.size = wep:GetDTInt( 0 ) or 32
	self.mode = wep:GetDTInt( 1 ) or 1
		
	if self.mode == 1 then
		self.pos = self.EfOwner:GetShootPos() + self.EfOwner:GetAimVector() * 84
	elseif self.mode == 2 then
		self.pos = self.EfOwner:GetEyeTrace().HitPos + Vector(0,0,wep:GetDTInt( 0 )-10)
	end
	
	self.Entity:SetPos( self.pos )
	
	self:SetRenderBounds( Vector( -self.size*5, -self.size*5, -self.size*5 ), Vector( self.size*5, self.size*5, self.size*5 ) )
	
	return (self and self.EfOwner and IsValid(self.EfOwner) and self.EfOwner:GetActiveWeapon() and self.EfOwner:GetActiveWeapon():GetClass() == "admin_exploitblocker" and self.EfOwner:Alive())
end


function EFFECT:Render()

	if self.pos and self.size and self.EfOwner and self.EfOwner == MySelf then
		render.SetBlend( 0.3 )
		render.SetColorModulation( 0, 1, 0 )
		self.Entity:SetModelScale( self.size * 2 * scale , 0 )
		self.Entity:DrawModel()
		render.CullMode( MATERIAL_CULLMODE_CW ) 
		self.Entity:DrawModel()
		render.CullMode( MATERIAL_CULLMODE_CCW ) 
		render.SetColorModulation( 1, 1, 1 )
		render.SetBlend( 1 )
	end
	
	
end
